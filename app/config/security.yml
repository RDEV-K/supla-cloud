security:
  encoders:
    SuplaBundle\Entity\User: bcrypt
    legacy_encoder: md5
  hide_user_not_found: false

  firewalls:
    oauth_token:
      pattern:    ^/oauth/v2/token
      security:   false

    oauth_authorize:
      pattern:    ^/oauth/v2/auth
      form_login:
        provider: supla_db_provider
        check_path: _oauth_login_check
        login_path: _oauth_login
        use_referer: true

    api:
      anonymous: true
      fos_oauth: true
      pattern: ^/api/
      stateless: true

  access_control:
    -
      path: ^/(api/(v?\d\.\d\.\d/)?(server-status|server-info|register|forgotten-password|confirm|webapp-tokens|webapp-auth))
      role: [IS_AUTHENTICATED_ANONYMOUSLY]
      requires_channel: '%supla_protocol%'
    -
      path: ^/api
      role: [IS_AUTHENTICATED_FULLY]
      requires_channel: '%supla_protocol%'
    -
      path: ^/
      role: [IS_AUTHENTICATED_ANONYMOUSLY]
      requires_channel: '%supla_protocol%'

  providers:
    supla_db_provider:
      id: 'SuplaApiBundle\Auth\UserProvider'
